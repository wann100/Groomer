<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Map</title>

    <!-- Bootstrap -->
    <link href="statics/css/bootstrap.min.css" rel="stylesheet">
    <link href="statics/css/custom.css" rel="stylesheet">
    
      
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    
    <script src="statics/js/bootstrap.min.js"></script>
    <script src="http://maps.googleapis.com/maps/api/js"></script>

    

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>
    <center>
         	 
      <nav class="navbar navbar-default bottomhomenav">
        <div class="container-fluid bottomhomenav">
          <div class="navbar-header bottomhomenav">
          		<center>
                <img class="img-responsive" src="statics/whole_logo.png"  style="width:20%; top:0px;left:0px;">
                </center>
            <button type="button" class="navbar-toggle" style="position:absolute;left:0px; top:0px;" data-toggle="collapse" data-target="#myNavbar">
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
		
          </div>
          <div class="collapse navbar-collapse bottomhomenav" id="myNavbar">
            <center>
              <ul class="nav navbar-nav ">
           
       <li class="active btn-xl" style="">
                	{{profilebutton}}
                  
								  <ul class="dropdown-menu">
                 		<li class="active btn-xl" style="">
                    	<a style=""href="/registerUser" rel="external" data-iconpos="center" data-icon="search"><span class="glyphicon glyphicon-search"></span>As a user</a>
                   	</li>
                    <li class="active btn-xl" style="">
                      <a style=""href="/registerPage1" rel="external" data-iconpos="center" data-icon="search"><span class="glyphicon glyphicon-search"></span>As a Hair Dresser</a>
                   	</li>
                  </ul>
                </li>
                <li class="active btn-xl" style="">
         <script>

  function getLocation(){
		var geo;
	    if(navigator && navigator.geolocation){
			navigator.geolocation.getCurrentPosition(showPosition);
			
		}
		else{
			console.log('Geolocation is not supported');
		}
	
    
  }

  function showPosition(position){
    geo =position.coords;
	document.getElementById("location").value  = "["+geo.latitude+ "," + geo.longitude + "]";
  }
  </script>
                   <form   method="post"  onSubmit="getLocation()" action="/map" style="color:white;">
		<center>
 <button    class=" button-effect btn-block"type="submit"  style="color:black; box-shadow:none; border:none;padding: 10px 15px;"><span class="glyphicon glyphicon-search"></span>Find A Hair Professional</button>
        </center>
          <label style="visibility:hidden" for="location" >Location:</label>
          <input  type="text" name="location" style="color:black; visibility:hidden" id="location" />
         <script>
 		  	getLocation();

			</script>
    
        
          <label for="range" style="visibility:hidden">Range in Miles:</label>
				<input id="range"  name="range"type="text" data-slider-min="0.0" data-slider-max="50" data-slider-step="5" data-slider-value="25.0" style="display: none; visibility:hidden" data-value="14" value="50.0">


        <label for="rating" style="visibility:hidden">Minimum Rating:</label>
        <input  name="rating" id="rating"type="text" data-slider-min="0" data-slider-max="5" data-slider-step="1" data-slider-value="3" style="display: none; visibility:hidden" data-value="14" value="3.0"/> 
        
        </form>
                    
                </li>
                
							</ul>
            </center>    
          </div>
        </div>
        			</nav>
	</center>
 
<div id="JSON" style="position:absolute;left:-8000px;">
  {{ jsonobject }}
  </div>
		<div id="maintextbox" title="Basic Dialogue" style="position:absolute;left:-8000px;">
        <table border="0" align="center" cellpadding="1" cellspacing="4">
  <tr>
    <td colspan="2"><h3 style="cursor: pointer;text-decoration:underline" onclick="gobarber('{username}')"><center>{Barber Name}</center></h3></td>
  </tr>
  <tr>
    <td rowspan="2"><a href="viewBarber/{username}"> <img src="viewPhoto/{photo}" width="90%" alt="Barber"/></a></td>
    <td width="50%">Stars:  {rating}<span class="stars s-{starnum}" data-default='{starnum}'>0 stars</span></td>
  </tr>
  <tr>
    <td width="50%">{Description}</td>
  </tr>
</table>

        </div>
		<div id="map_canvas" class="map rounded">
        
        This is where the map goes
        
        </div>
          <script>

  function getLocation(){
		var geo;
	    if(navigator && navigator.geolocation){
			navigator.geolocation.getCurrentPosition(showPosition);
			
		}
		else{
			console.log('Geolocation is not supported');
		}
	
    
  }

  function showPosition(position){
    geo =position.coords;
	document.getElementById("location").value  = "["+geo.latitude+ "," + geo.longitude + "]";
  }
  </script>

    <form method="post"  class="navbar navbar-default bottomhomenav" action="/map" style="color:white;">
      <div data-role="fieldcontain" data-type="horizontal">
          <label for="location">Change location:</label>
          <input type="text" name="location" style="color:black;" id="location"/>
        </div>
        <div data-role="fieldcontain" data-type="horizontal">
        
          <label  style="visibility:hidden"  for="range">Range in Miles:</label>
				<input id="range"  name="range"type="text" data-slider-min="0.0" data-slider-max="50" data-slider-step="5" data-slider-value="25.0" style="display: none;" data-value="14" value="25.0">

          </div>
          <div data-role="fieldcontain" style="background:transparent !important">
        <label style="visibility:hidden" for="rating">Minimum Rating:</label>
        <input  name="rating" id="rating"type="text" data-slider-min="0" data-slider-max="5" data-slider-step="1" data-slider-value="3" style="display: none;" data-value="14" value="3.0"/>
        </div>
        <input type="submit" class="form-control registerbutton"  value="Refresh Map" data-role="button" data-icon="info" data-iconpos="left" />
                 <script>
 		  	getLocation();

			</script>
        <br/>
        <br/>
        </form>
        
        <br/>
        
        <br/>
        <br/>
		<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script> 
		<script type="text/javascript" src="statics/js/underscore-1.2.2/underscore.min.js"></script>
		<script type="text/javascript" src="statics/js/backbone-0.5.3/backbone.min.js"></script>
		<script type="text/javascript" src="statics/js/prettify/prettify.min.js"></script>
		<script type="text/javascript" src="statics/js/demo.js"></script>
		<script type="text/javascript" src="statics/ui/jquery.ui.map.js"></script>
		<script type="text/javascript" src="statics/ui/jquery.ui.map.overlays.js"></script>
        <script type="text/javascript" src="statics/infobox.js"></script>
		<script type="text/javascript">
		function gobarber(str){
			window.location = "viewBarber/"+str
        }
		
		var text,clone,jsondata,disabled,geo;
		text = "This is to show it works"
		clone = $("#maintextbox").clone();
		disabled = 0
		geo = -1
		
		var mapOptions = {
			disableDoubleClickZoom: true,
			draggable:false,
			panControl:false
		};

		function getLocation()
		  {
		  if (navigator.geolocation && geo == -1)
			{
			navigator.geolocation.getCurrentPosition(showPosition);
			}
		  }
		function showPosition(position)
		  {
		  geo = position.coords
		  }
		 
		function jsongmap(data){			
			$.each( data.markers, function(i, marker) {
				if(marker.user == 1)iconimage = new google.maps.MarkerImage("statics/blue.png")
				else{iconimage = new google.maps.MarkerImage("statics/red.png")}
				$('#map_canvas').gmap('addMarker', {
					'position': new google.maps.LatLng(marker.latitude, marker.longitude), 
					'bounds': true ,
					'icon': iconimage
				}).click(function() {
					//document.getElementById('maintextbox').innerHTML = marker.content
					if(marker.user == 0){
						replace_text(marker);
						text = clone.html()
						$('#map_canvas').gmap('openInfoWindow', { 'content': "<div id=txt>"+text+"</div>"}, this);
	
						//$('#maintextbox').dialog();
						
						/*$('#map_canvas').gmap('displayStreetView', 'streetview{0}'.replace('{0}', i), { 
							//'position': $(this).get(0).getPosition() 
							'position': new google.maps.LatLng(marker.latitude, marker.longitude), 
						});*/
					}
				});
			});
		}
		

		function change_all(){
			var str;
			$('#map_canvas').gmap('closeInfoWindow');
			$('#map_canvas').gmap('clear', 'markers');
			var req = new XMLHttpRequest();
			var async = false;
			var query = "action=getMapData";
			if (document.getElementById("geolocation").checked)
			{
				query+="&arg0=["+geo.latitude+","+geo.longitude+"]";
				var req2 = new XMLHttpRequest();
				var query2 = "action=getStreetAddress&arg0="+geo.latitude+","+geo.longitude;
				req2.open('GET','/database?' + query2,async);
				req2.send();
				document.getElementById("location").value = req2.responseText;
			}
			else
			{
				query+="&arg0="+document.getElementById("location").value;
			}
			query+="&arg1="+0;
			query+="&arg2="+50;
			req.open('GET', '/database?' + query, async);
			req.send();
			str = req.responseText;
			jsondata = jQuery.parseJSON(str); 
			jsongmap(jsondata);
		}
		
		function replace_text(marker){
			var elm,barbername,starnum,rating,description,photo;
			clone = $("#maintextbox").clone();
			elm = clone
			username = marker.title
			barbername = marker.barbername
			starnum = marker.starnum
			description = marker.description
			photo = marker.photo
			rating = marker.rating
			
			elm.html(elm.html().replace(/{username}/g,username))
			elm.html(elm.html().replace(/{Barber Name}/g,barbername))

			if(rating == "0")elm.html(elm.html().replace("{rating}","Not Rated"))
			elm.html(elm.html().replace(/{rating}/g,rating))
			elm.html(elm.html().replace(/{starnum}/g,starnum))
			elm.html(elm.html().replace(/{Description}/g,description))
			
			if(photo.length == 0){
				elm.html(elm.html().replace("viewPhoto/{photo}","statics/silhouette.png"))
			}
			else{
				elm.html(elm.html().replace(/{photo}/g,photo))
			}
		}
		
		$('#map_canvas').gmap().bind('init', function(evt, map) {
			var str;
			str = $("#JSON").html()
			jsondata = jQuery.parseJSON(str); 
			jsongmap(jsondata);
		});
		//$('#map_canvas').gmap().set('draggable', false);
        </script>
  
<!--Google Maps API-->

    
  </body>
</html>