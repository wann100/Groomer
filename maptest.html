<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Map</title>

    <!-- Bootstrap -->
    <link href="statics/css/bootstrap.min.css" rel="stylesheet">
    <link href="statics/css/custom.css" rel="stylesheet">
     <link href="statics/css/simple-sidebar.css" rel="stylesheet">
    
	<!--[if lt IE 9]>
		<script src="http://code.jquery.com/jquery-1.10.2.js"></script>
	<![endif]-->
	<!--[if gte IE 9]><!-->
	<script src="http://code.jquery.com/jquery-2.0.3.js"></script>
<!--<![endif]-->

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    
    <script src="statics/js/bootstrap.min.js"></script>
<script src='https://api.mapbox.com/mapbox.js/v2.3.0/mapbox.js'></script>
<script>

window.onload = function(){
	if($(window).width()<700){
	document.getElementById("registerbuttons").style.visibility='hidden';
	document.getElementById("logo").style.width="250px";
	//document.getElementById("map").style.top = "100px";
	}
}
</script>
<link href='https://api.mapbox.com/mapbox.js/v2.3.0/mapbox.css' rel='stylesheet' />
<script>

  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-53244369-3', 'auto');
  ga('send', 'pageview');
</script>
<style>
  body { margin:0; padding:0; }
  #map { position:fixed; top:200px; bottom:0; left:0px; width:100%; height:80%; border:rgb(78,110,128); border-style:dashed; border-width:2px;}
  .bottomhomenav {
      background-color: rgb(57, 57, 57) !important;
      filter: none;
      opacity: 1;
      border: none;

  }
  .sidebar-wrapper{
	 
  }
</style>



    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>
    <center>
         <div id="wrapper" style="box-shadow: 2px 2px 5px #888888;">

        <!-- Sidebar -->
        <div id="sidebar-wrapper" style=" color:white; background:rgb(57,57,57);box-shadow: 5px 0px 20px rgb(78,110,128) ;">
            <ul class="sidebar-nav" >
                <li class="sidebar-brand" style="font-family:web-font; border-bottom:double;cursor: pointer; cursor: hand; border-color:white;">
                    	
                          <a id="insidebutton"><span id="mainmenu" style="color:white; ">Click to Minimize</span></a>
                    
                </li>
                 {{sidemenu}}
<script src="https://static.wepay.com/min/js/wepay.v2.js" type="text/javascript"></script>
<script type="text/javascript">

WePay.set_endpoint("production"); // stage or production

WePay.OAuth2.button_init(document.getElementById('start_oauth2'), {
    "client_id":"147330",
     "scope":["manage_accounts","collect_payments","view_user","send_money","preapprove_payments"],
    "user_name":"your name",
    "user_email":"your@email.com",
    "redirect_uri":"http://www.headwayapp.net/map",
    "top":100, // control the positioning of the popup with the top and left params
    "left":100,
    "state":"robot", // this is an optional parameter that lets you persist some state value through the flow
    "callback":function(data) {
		/** This callback gets fired after the user clicks "grant access" in the popup and the popup closes. The data object will include the code which you can pass to your server to make the /oauth2/token call **/
		if (data.code.length !== 0) {
			// send the data to the server
		//	alert("RUNNING!")
			var req = new XMLHttpRequest();
			var async = false;
			var query = "?code="+data.code;
			req.open('GET', '/useraccountcreate' + query, async);
			req.send();
			//alert(req.responseText)
		} else {
			// an error has occurred and will be in data.error
			alert("An Error Has Occurred.")
		}
	}
});

</script>
                
            </ul>
        </div>
        <!-- /#sidebar-wrapper -->

        <!-- Page Content -->
        <div id="page-content-wrapper">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-lg-12">
      	 <nav class="navbar" style="height:8%">
          <div class="container-fluid" >
          <a href="#menu-toggle" class="btn btn-default" id="menu-toggle" style=" color:white; position:absolute;top:0px;left:0;background:rgb(57,57,57); margin-top:-15px; margin-left:-30px">
                    <span class="glyphicon glyphicon-align-justify"> MENU</span>
        
              </a>
            <img  id="logo" class="img-responsive" src="statics/whole_logo.png"  width="150" height="236" style="top:0px;left:0px;margin-top:-10px; ">
            <a href="javascript:history.back(1)" class="btn  btn-default glyphicon  glyphicon-arrow-left " data-rel="back" style="color:white; position:absolute;top:0px;right:0px; background:rgb(57,57,57)!important; margin-top:-15px; margin-right:-30px"rel=	"external" ></a>
   <button class="btn-lg btn-block dropdown-toggle registerbutton"   aria-haspopup="true" aria-expanded="false" data-toggle="dropdown"  style=" font-family:webfont; padding-top:-4px" >Register For Free</button>
<ul class="dropdown-menu">
<li class="active btn-xl" style=""><a style=""href="/registerUser" rel="external" data-iconpos="center" data-icon="search"><span class="glyphicon glyphicon-search"></span>As a user</a></li>
<li class="active btn-xl" style=""><a style=""href="/registerPage1" rel="external" data-iconpos="center" data-icon="search"><span class="glyphicon glyphicon-search"></span>As a Hair Dresser</a></li></ul>
          	</div>
        

            <div id='map'></div>
            
            </nav> 
     
      
    </div>

                    </div>
                </div>
            </div>
  
        </div>
        <!-- /#page-content-wrapper -->

    </div>
        

  
        			
<div id="JSON"  style="position:absolute;left:-8000px;">
  {{ jsonobject }}
  </div>
		<div id="maintextbox" title="Basic Dialogue" style="position:absolute;left:-8000px;">
        <table border="0" align="center" cellpadding="1" cellspacing="4">
  <tr>
    <td colspan="2"><h3 style="cursor: pointer;text-decoration:underline" onclick="gobarber('{username}')"><center>{Barber Name}</center></h3></td>
  </tr>
  <tr>
    <td rowspan="2"><a href="viewBarber/{username}"> <img src="viewPhoto/{photo}" width="90%" alt="Barber"/></a></td>
    <td width="50%">Stars:  {rating}<span class="stars s-{starnum}" data-default='{starnum}'>0 stars</span></td>
  </tr>
  <tr>
    <td width="50%">{Description}</td>
  </tr>
</table>

        </div>
<!--
-->
<!-- jQuery is required for this example. -->

<script>
window.onbeforeunload = 
L.mapbox.accessToken = 'pk.eyJ1IjoibWFtYWRvdXdhbm4iLCJhIjoiY2lsanN0cjN2NWExOXZhbWN0M2E0NHRlZyJ9.Jry4JWNICLD2GcujnV9oIw';


var map = L.mapbox.map('map')
L.mapbox.styleLayer('mapbox://styles/mamadouwann/cim3utpbu00ed9jm01c96571p').addTo(map);
map.locate({setView: true, maxZoom: 12});
var myLayer = L.mapbox.featureLayer().addTo(map);
function onLocationFound(e) {
  
var str = '{{jsonobject}}';
var n = jQuery.parseJSON(str);
myLayer.setGeoJSON(n);

		

}
myLayer.on('layeradd', function(e) {
    var marker = e.layer,
        feature = marker.feature;
	
    // Create custom popup content
	var newurl = /viewBarber/+feature.properties.username ;
	var photourl = feature.properties.image;
	if(feature.properties.user=="0.0"){
	//marker.setIcon(L.icon(feature.properties.icon));
    var popupContent =  '<a href="'+newurl.toString() + '">' +
                          ' <center> <h3>'+  feature.properties.title+
						  ' <center><span class="stars s-'+feature.properties.mystars+'" data-default='+feature.properties.starnum+' style="text-align:right">0 stars</span></center>' +
						 '</h3></center>'+
						 ' <center><img width=50px src="'+photourl+'"></center>'+
                         
                        '</a>';
	}
	else{
		var popupContent = feature.properties.title;
	}
		

    // http://leafletjs.com/reference.html#popup
    marker.bindPopup(popupContent,{
        closeButton: false,
        minWidth: 50,
		maxWidth:150
    });
});

// Add features to the map


map.on('locationfound', onLocationFound);
	
// The HTML we put in bindPopup doesn't exist yet, so we can't just say
// $('#mybutton'). Instead, we listen for click events on the map element which
// will bubble up from the tooltip, once it's created and someone clicks on it.

		//$('#map_canvas').gmap().set('draggable', false);
        </script>

<!--    <form method="post"  class="navbar navbar-default bottomhomenav" action="/map" style="color:white;">
      <div data-role="fieldcontain" data-type="horizontal">
          <label for="location">Change location:</label>
          <input type="text" name="location" style="color:black;" id="location"/>
        </div>
        <div data-role="fieldcontain" data-type="horizontal">
        
          <label  style="visibility:hidden"  for="range">Range in Miles:</label>
				<input id="range"  name="range"type="text" data-slider-min="0.0" data-slider-max="50" data-slider-step="5" data-slider-value="25.0" style="display: none;" data-value="14" value="25.0">

          </div>
          <div data-role="fieldcontain" style="background:transparent !important">
        <label style="visibility:hidden" for="rating">Minimum Rating:</label>
        <input  name="rating" id="rating"type="text" data-slider-min="0" data-slider-max="5" data-slider-step="1" data-slider-value="3" style="display: none;" data-value="14" value="3.0"/>
        </div>
        <input type="submit" class="form-control registerbutton"  value="Refresh Map" data-role="button" data-icon="info" data-iconpos="left" />
                 <script>
 		  	getLocation();

			</script>
        <br/>
       <br/>
        </form>-->
        
        <br/>
        
        <br/>

		<script type="text/javascript">
		function gobarber(str){
			window.location = "viewBarber/"+str
        }
		
		var text,clone,jsondata,disabled,geo;
		text = "This is to show it works"
		clone = $("#maintextbox").clone();
		disabled = 0
		geo = -1
		
		var mapOptions = {
			disableDoubleClickZoom: true,
			draggable:false,
			panControl:false
		};

		function getLocation()
		  {
		  if (navigator.geolocation && geo == -1)
			{
			navigator.geolocation.getCurrentPosition(showPosition);
			}
		  }
		function showPosition(position)
		  {
		  geo = position.coords
		  }
		 
</script>
     <script>

	
    $("#menu-toggle").click(function(e) {
        e.preventDefault();
	
        $("#wrapper").toggleClass("toggled");
		if(document.getElementById("wrapper").className =="toggled"){

		document.getElementById("menu-toggle").style.display = "none";}
		
    });
	    $("#insidebutton").click(function(e) {
        e.preventDefault();
        $("#wrapper").toggleClass("toggled");
		document.getElementById("menu-toggle").style.display = "initial";
    });
    </script>
<!--Google Maps API-->

    
  </body>
</html>